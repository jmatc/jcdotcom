!function(t){var e="object"==typeof self&&self.self==self&&self||"object"==typeof global&&global.global==global&&global;if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],function(i,r,s){e.Backbone=t(e,s,i,r)});else if("undefined"!=typeof exports){var r,i=require("underscore");try{r=require("jquery")}catch(s){}t(e,exports,i,r)}else e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}(function(t,e,i,r){var s=t.Backbone,n=[].slice;e.VERSION="1.2.1",e.$=r,e.noConflict=function(){return t.Backbone=s,this},e.emulateHTTP=!1,e.emulateJSON=!1;var a=function(t,e,r){switch(t){case 1:return function(){return i[e](this[r])};case 2:return function(t){return i[e](this[r],t)};case 3:return function(t,s){return i[e](this[r],t,s)};case 4:return function(t,s,n){return i[e](this[r],t,s,n)};default:return function(){var t=n.call(arguments);return t.unshift(this[r]),i[e].apply(i,t)}}},o=function(t,e,r){i.each(e,function(e,s){i[s]&&(t.prototype[s]=a(e,s,r))})},h=e.Events={},u=/\s+/,l=function(t,e,r,s,n){var o,a=0;if(r&&"object"==typeof r){void 0!==s&&"context"in n&&void 0===n.context&&(n.context=s);for(o=i.keys(r);a<o.length;a++)e=t(e,o[a],r[o[a]],n)}else if(r&&u.test(r))for(o=r.split(u);a<o.length;a++)e=t(e,o[a],s,n);else e=t(e,r,s,n);return e};h.on=function(t,e,i){return c(this,t,e,i)};var c=function(t,e,i,r,s){if(t._events=l(f,t._events||{},e,i,{context:r,ctx:t,listening:s}),s){var n=t._listeners||(t._listeners={});n[s.id]=s}return t};h.listenTo=function(t,e,r){if(!t)return this;var s=t._listenId||(t._listenId=i.uniqueId("l")),n=this._listeningTo||(this._listeningTo={}),a=n[s];if(!a){var o=this._listenId||(this._listenId=i.uniqueId("l"));a=n[s]={obj:t,objId:s,id:o,listeningTo:n,count:0}}return c(t,e,r,this,a),this};var f=function(t,e,i,r){if(i){var s=t[e]||(t[e]=[]),n=r.context,a=r.ctx,o=r.listening;o&&o.count++,s.push({callback:i,context:n,ctx:n||a,listening:o})}return t};h.off=function(t,e,i){return this._events?(this._events=l(d,this._events,t,e,{context:i,listeners:this._listeners}),this):this},h.stopListening=function(t,e,r){var s=this._listeningTo;if(!s)return this;for(var n=t?[t._listenId]:i.keys(s),a=0;a<n.length;a++){var o=s[n[a]];if(!o)break;o.obj.off(e,r,this)}return i.isEmpty(s)&&(this._listeningTo=void 0),this};var d=function(t,e,r,s){if(t){var a,n=0,o=s.context,h=s.listeners;if(e||r||o){for(var l=e?[e]:i.keys(t);n<l.length;n++){e=l[n];var c=t[e];if(!c)break;for(var f=[],d=0;d<c.length;d++){var v=c[d];r&&r!==v.callback&&r!==v.callback._callback||o&&o!==v.context?f.push(v):(a=v.listening,a&&0===--a.count&&(delete h[a.id],delete a.listeningTo[a.objId]))}f.length?t[e]=f:delete t[e]}return i.size(t)?t:void 0}for(var u=i.keys(h);n<u.length;n++)a=h[u[n]],delete h[a.id],delete a.listeningTo[a.objId]}};h.once=function(t,e,r){var s=l(v,{},t,e,i.bind(this.off,this));return this.on(s,void 0,r)},h.listenToOnce=function(t,e,r){var s=l(v,{},e,r,i.bind(this.stopListening,this,t));return this.listenTo(t,s)};var v=function(t,e,r,s){if(r){var n=t[e]=i.once(function(){s(e,n),r.apply(this,arguments)});n._callback=r}return t};h.trigger=function(t){if(!this._events)return this;for(var e=Math.max(0,arguments.length-1),i=Array(e),r=0;e>r;r++)i[r]=arguments[r+1];return l(g,this._events,t,void 0,i),this};var g=function(t,e,i,r){if(t){var s=t[e],n=t.all;s&&n&&(n=n.slice()),s&&p(s,r),n&&p(n,[e].concat(r))}return t},p=function(t,e){var i,r=-1,s=t.length,n=e[0],a=e[1],o=e[2];switch(e.length){case 0:for(;++r<s;)(i=t[r]).callback.call(i.ctx);return;case 1:for(;++r<s;)(i=t[r]).callback.call(i.ctx,n);return;case 2:for(;++r<s;)(i=t[r]).callback.call(i.ctx,n,a);return;case 3:for(;++r<s;)(i=t[r]).callback.call(i.ctx,n,a,o);return;default:for(;++r<s;)(i=t[r]).callback.apply(i.ctx,e);return}};h.bind=h.on,h.unbind=h.off,i.extend(e,h);var m=e.Model=function(t,e){var r=t||{};e||(e={}),this.cid=i.uniqueId(this.cidPrefix),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(r=this.parse(r,e)||{}),r=i.defaults({},r,i.result(this,"defaults")),this.set(r,e),this.changed={},this.initialize.apply(this,arguments)};i.extend(m.prototype,h,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(t){return i.clone(this.attributes)},sync:function(){return e.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return i.escape(this.get(t))},has:function(t){return null!=this.get(t)},matches:function(t){return!!i.iteratee(t,this)(this.attributes)},set:function(t,e,r){if(null==t)return this;var s;if("object"==typeof t?(s=t,r=e):(s={})[t]=e,r||(r={}),!this._validate(s,r))return!1;var n=r.unset,a=r.silent,o=[],h=this._changing;this._changing=!0,h||(this._previousAttributes=i.clone(this.attributes),this.changed={});var u=this.attributes,l=this.changed,c=this._previousAttributes;this.idAttribute in s&&(this.id=s[this.idAttribute]);for(var f in s)e=s[f],i.isEqual(u[f],e)||o.push(f),i.isEqual(c[f],e)?delete l[f]:l[f]=e,n?delete u[f]:u[f]=e;if(!a){o.length&&(this._pending=r);for(var d=0;d<o.length;d++)this.trigger("change:"+o[d],this,u[o[d]],r)}if(h)return this;if(!a)for(;this._pending;)r=this._pending,this._pending=!1,this.trigger("change",this,r);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,i.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var r in this.attributes)e[r]=void 0;return this.set(e,i.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!i.isEmpty(this.changed):i.has(this.changed,t)},changedAttributes:function(t){if(!t)return this.hasChanged()?i.clone(this.changed):!1;var e=this._changing?this._previousAttributes:this.attributes,r={};for(var s in t){var n=t[s];i.isEqual(e[s],n)||(r[s]=n)}return i.size(r)?r:!1},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return i.clone(this._previousAttributes)},fetch:function(t){t=i.extend({parse:!0},t);var e=this,r=t.success;return t.success=function(i){var s=t.parse?e.parse(i,t):i;return e.set(s,t)?(r&&r.call(t.context,e,i,t),void e.trigger("sync",e,i,t)):!1},q(this,t),this.sync("read",this,t)},save:function(t,e,r){var s;null==t||"object"==typeof t?(s=t,r=e):(s={})[t]=e,r=i.extend({validate:!0,parse:!0},r);var n=r.wait;if(s&&!n){if(!this.set(s,r))return!1}else if(!this._validate(s,r))return!1;var a=this,o=r.success,h=this.attributes;r.success=function(t){a.attributes=h;var e=r.parse?a.parse(t,r):t;return n&&(e=i.extend({},s,e)),e&&!a.set(e,r)?!1:(o&&o.call(r.context,a,t,r),void a.trigger("sync",a,t,r))},q(this,r),s&&n&&(this.attributes=i.extend({},h,s));var u=this.isNew()?"create":r.patch?"patch":"update";"patch"!==u||r.attrs||(r.attrs=s);var l=this.sync(u,this,r);return this.attributes=h,l},destroy:function(t){t=t?i.clone(t):{};var e=this,r=t.success,s=t.wait,n=function(){e.stopListening(),e.trigger("destroy",e,e.collection,t)};t.success=function(i){s&&n(),r&&r.call(t.context,e,i,t),e.isNew()||e.trigger("sync",e,i,t)};var a=!1;return this.isNew()?i.defer(t.success):(q(this,t),a=this.sync("delete",this,t)),s||n(),a},url:function(){var t=i.result(this,"urlRoot")||i.result(this.collection,"url")||M();if(this.isNew())return t;var e=this.get(this.idAttribute);return t.replace(/[^\/]$/,"$&/")+encodeURIComponent(e)},parse:function(t,e){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},i.defaults({validate:!0},t))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=i.extend({},this.attributes,t);var r=this.validationError=this.validate(t,e)||null;return r?(this.trigger("invalid",this,r,i.extend(e,{validationError:r})),!1):!0}});var _={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};o(m,_,"attributes");var y=e.Collection=function(t,e){e||(e={}),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,i.extend({silent:!0},e))},b={add:!0,remove:!0,merge:!0},x={add:!0,remove:!1};i.extend(y.prototype,h,{model:m,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return e.sync.apply(this,arguments)},add:function(t,e){return this.set(t,i.extend({merge:!1},e,x))},remove:function(t,e){e=i.extend({},e);var r=!i.isArray(t);t=r?[t]:i.clone(t);var s=this._removeModels(t,e);return!e.silent&&s&&this.trigger("update",this,e),r?s[0]:s},set:function(t,e){e=i.defaults({},e,b),e.parse&&!this._isModel(t)&&(t=this.parse(t,e));var r=!i.isArray(t);t=r?t?[t]:[]:t.slice();var s,n,a,o,h,u=e.at;null!=u&&(u=+u),0>u&&(u+=this.length+1);for(var l=this.comparator&&null==u&&e.sort!==!1,c=i.isString(this.comparator)?this.comparator:null,f=[],d=[],v={},g=e.add,p=e.merge,m=e.remove,_=!l&&g&&m?[]:!1,y=!1,x=0;x<t.length;x++){if(a=t[x],o=this.get(a))m&&(v[o.cid]=!0),p&&a!==o&&(a=this._isModel(a)?a.attributes:a,e.parse&&(a=o.parse(a,e)),o.set(a,e),l&&!h&&o.hasChanged(c)&&(h=!0)),t[x]=o;else if(g){if(n=t[x]=this._prepareModel(a,e),!n)continue;f.push(n),this._addReference(n,e)}n=o||n,n&&(s=this.modelId(n.attributes),!_||!n.isNew()&&v[s]||(_.push(n),y=y||!this.models[x]||n.cid!==this.models[x].cid),v[s]=!0)}if(m){for(var x=0;x<this.length;x++)v[(n=this.models[x]).cid]||d.push(n);d.length&&this._removeModels(d,e)}if(f.length||y)if(l&&(h=!0),this.length+=f.length,null!=u)for(var x=0;x<f.length;x++)this.models.splice(u+x,0,f[x]);else{_&&(this.models.length=0);for(var w=_||f,x=0;x<w.length;x++)this.models.push(w[x])}if(h&&this.sort({silent:!0}),!e.silent){for(var E=null!=u?i.clone(e):e,x=0;x<f.length;x++)null!=u&&(E.index=u+x),(n=f[x]).trigger("add",n,this,E);(h||y)&&this.trigger("sort",this,e),(f.length||d.length)&&this.trigger("update",this,e)}return r?t[0]:t},reset:function(t,e){e=e?i.clone(e):{};for(var r=0;r<this.models.length;r++)this._removeReference(this.models[r],e);return e.previousModels=this.models,this._reset(),t=this.add(t,i.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},push:function(t,e){return this.add(t,i.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t)},unshift:function(t,e){return this.add(t,i.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t)},slice:function(){return n.apply(this.models,arguments)},get:function(t){if(null==t)return void 0;var e=this.modelId(this._isModel(t)?t.attributes:t);return this._byId[t]||this._byId[e]||this._byId[t.cid]},at:function(t){return 0>t&&(t+=this.length),this.models[t]},where:function(t,e){var r=i.matches(t);return this[e?"find":"filter"](function(t){return r(t.attributes)})},findWhere:function(t){return this.where(t,!0)},sort:function(t){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return t||(t={}),i.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(i.bind(this.comparator,this)),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return i.invoke(this.models,"get",t)},fetch:function(t){t=i.extend({parse:!0},t);var e=t.success,r=this;return t.success=function(i){var s=t.reset?"reset":"set";r[s](i,t),e&&e.call(t.context,r,i,t),r.trigger("sync",r,i,t)},q(this,t),this.sync("read",this,t)},create:function(t,e){e=e?i.clone(e):{};var r=e.wait;if(t=this._prepareModel(t,e),!t)return!1;r||this.add(t,e);var s=this,n=e.success;return e.success=function(t,e,i){r&&s.add(t,i),n&&n.call(i.context,t,e,i)},t.save(null,e),t},parse:function(t,e){return t},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(t){return t[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){if(this._isModel(t))return t.collection||(t.collection=this),t;e=e?i.clone(e):{},e.collection=this;var r=new this.model(t,e);return r.validationError?(this.trigger("invalid",this,r.validationError,e),!1):r},_removeModels:function(t,e){for(var i=[],r=0;r<t.length;r++){var s=this.get(t[r]);if(s){var n=this.indexOf(s);this.models.splice(n,1),this.length--,e.silent||(e.index=n,s.trigger("remove",s,this,e)),i.push(s),this._removeReference(s,e)}}return i.length?i:!1},_isModel:function(t){return t instanceof m},_addReference:function(t,e){this._byId[t.cid]=t;var i=this.modelId(t.attributes);null!=i&&(this._byId[i]=t),t.on("all",this._onModelEvent,this)},_removeReference:function(t,e){delete this._byId[t.cid];var i=this.modelId(t.attributes);null!=i&&delete this._byId[i],this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,r){if("add"!==t&&"remove"!==t||i===this){if("destroy"===t&&this.remove(e,r),"change"===t){var s=this.modelId(e.previousAttributes()),n=this.modelId(e.attributes);s!==n&&(null!=s&&delete this._byId[s],null!=n&&(this._byId[n]=e))}this.trigger.apply(this,arguments)}}});var w={forEach:3,each:3,map:3,collect:3,reduce:4,foldl:4,inject:4,reduceRight:4,foldr:4,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:2,contains:2,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3};o(y,w,"models");var E=["groupBy","countBy","sortBy","indexBy"];i.each(E,function(t){i[t]&&(y.prototype[t]=function(e,r){var s=i.isFunction(e)?e:function(t){return t.get(e)};return i[t](this.models,s,r)})});var k=e.View=function(t){this.cid=i.uniqueId("view"),i.extend(this,i.pick(t,I)),this._ensureElement(),this.initialize.apply(this,arguments)},S=/^(\S+)\s*(.*)$/,I=["model","collection","el","id","attributes","className","tagName","events"];i.extend(k.prototype,h,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(t){return this.undelegateEvents(),this._setElement(t),this.delegateEvents(),this},_setElement:function(t){this.$el=t instanceof e.$?t:e.$(t),this.el=this.$el[0]},delegateEvents:function(t){if(t||(t=i.result(this,"events")),!t)return this;this.undelegateEvents();for(var e in t){var r=t[e];if(i.isFunction(r)||(r=this[r]),r){var s=e.match(S);this.delegate(s[1],s[2],i.bind(r,this))}}return this},delegate:function(t,e,i){return this.$el.on(t+".delegateEvents"+this.cid,e,i),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(t,e,i){return this.$el.off(t+".delegateEvents"+this.cid,e,i),this},_createElement:function(t){return document.createElement(t)},_ensureElement:function(){if(this.el)this.setElement(i.result(this,"el"));else{var t=i.extend({},i.result(this,"attributes"));this.id&&(t.id=i.result(this,"id")),this.className&&(t["class"]=i.result(this,"className")),this.setElement(this._createElement(i.result(this,"tagName"))),this._setAttributes(t)}},_setAttributes:function(t){this.$el.attr(t)}}),e.sync=function(t,r,s){var n=T[t];i.defaults(s||(s={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var a={type:n,dataType:"json"};if(s.url||(a.url=i.result(r,"url")||M()),null!=s.data||!r||"create"!==t&&"update"!==t&&"patch"!==t||(a.contentType="application/json",a.data=JSON.stringify(s.attrs||r.toJSON(s))),s.emulateJSON&&(a.contentType="application/x-www-form-urlencoded",a.data=a.data?{model:a.data}:{}),s.emulateHTTP&&("PUT"===n||"DELETE"===n||"PATCH"===n)){a.type="POST",s.emulateJSON&&(a.data._method=n);var o=s.beforeSend;s.beforeSend=function(t){return t.setRequestHeader("X-HTTP-Method-Override",n),o?o.apply(this,arguments):void 0}}"GET"===a.type||s.emulateJSON||(a.processData=!1);var h=s.error;s.error=function(t,e,i){s.textStatus=e,s.errorThrown=i,h&&h.call(s.context,t,e,i)};var u=s.xhr=e.ajax(i.extend(a,s));return r.trigger("request",r,u,s),u};var T={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};e.ajax=function(){return e.$.ajax.apply(e.$,arguments)};var P=e.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},H=/\((.*?)\)/g,$=/(\(\?)?:\w+/g,A=/\*\w+/g,C=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend(P.prototype,h,{initialize:function(){},route:function(t,r,s){i.isRegExp(t)||(t=this._routeToRegExp(t)),i.isFunction(r)&&(s=r,r=""),s||(s=this[r]);var n=this;return e.history.route(t,function(i){var a=n._extractParameters(t,i);n.execute(s,a,r)!==!1&&(n.trigger.apply(n,["route:"+r].concat(a)),n.trigger("route",r,a),e.history.trigger("route",n,r,a))}),this},execute:function(t,e,i){t&&t.apply(this,e)},navigate:function(t,i){return e.history.navigate(t,i),this},_bindRoutes:function(){if(this.routes){this.routes=i.result(this,"routes");for(var t,e=i.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(C,"\\$&").replace(H,"(?:$1)?").replace($,function(t,e){return e?t:"([^/?]+)"}).replace(A,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(t,e){var r=t.exec(e).slice(1);return i.map(r,function(t,e){return e===r.length-1?t||null:t?decodeURIComponent(t):null})}});var N=e.History=function(){this.handlers=[],i.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},R=/^[#\/]|\s+$/g,j=/^\/+|\/+$/g,O=/#.*$/;N.started=!1,i.extend(N.prototype,h,{interval:50,atRoot:function(){var t=this.location.pathname.replace(/[^\/]$/,"$&/");return t===this.root&&!this.getSearch()},matchRoot:function(){var t=this.decodeFragment(this.location.pathname),e=t.slice(0,this.root.length-1)+"/";return e===this.root},decodeFragment:function(t){return decodeURI(t.replace(/%25/g,"%2525"))},getSearch:function(){var t=this.location.href.replace(/#.*/,"").match(/\?.+/);return t?t[0]:""},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getPath:function(){var t=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===t.charAt(0)?t.slice(1):t},getFragment:function(t){return null==t&&(t=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),t.replace(R,"")},start:function(t){if(N.started)throw new Error("Backbone.history has already been started");if(N.started=!0,this.options=i.extend({root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._hasHashChange="onhashchange"in window,this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(j,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var e=this.root.slice(0,-1)||"/";return this.location.replace(e+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var r=document.body,s=r.insertBefore(this.iframe,r.firstChild).contentWindow;s.document.open(),s.document.close(),s.location.hash="#"+this.fragment}var n=window.addEventListener||function(t,e){return attachEvent("on"+t,e)};return this._usePushState?n("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?n("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.options.silent?void 0:this.loadUrl()},stop:function(){var t=window.removeEventListener||function(t,e){return detachEvent("on"+t,e)};this._usePushState?t("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&t("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),N.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();return e===this.fragment&&this.iframe&&(e=this.getHash(this.iframe.contentWindow)),e===this.fragment?!1:(this.iframe&&this.navigate(e),void this.loadUrl())},loadUrl:function(t){return this.matchRoot()?(t=this.fragment=this.getFragment(t),i.any(this.handlers,function(e){return e.route.test(t)?(e.callback(t),!0):void 0})):!1},navigate:function(t,e){if(!N.started)return!1;e&&e!==!0||(e={trigger:!!e}),t=this.getFragment(t||"");var i=this.root;(""===t||"?"===t.charAt(0))&&(i=i.slice(0,-1)||"/");var r=i+t;if(t=this.decodeFragment(t.replace(O,"")),this.fragment!==t){if(this.fragment=t,this._usePushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,r);else{if(!this._wantsHashChange)return this.location.assign(r);if(this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getHash(this.iframe.contentWindow)){var s=this.iframe.contentWindow;e.replace||(s.document.open(),s.document.close()),this._updateHash(s.location,t,e.replace)}}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,i){if(i){var r=t.href.replace(/(javascript:|#).*$/,"");t.replace(r+"#"+e)}else t.hash="#"+e}}),e.history=new N;var U=function(t,e){var s,r=this;s=t&&i.has(t,"constructor")?t.constructor:function(){return r.apply(this,arguments)},i.extend(s,r,e);var n=function(){this.constructor=s};return n.prototype=r.prototype,s.prototype=new n,t&&i.extend(s.prototype,t),s.__super__=r.prototype,s};m.extend=y.extend=P.extend=k.extend=N.extend=U;var M=function(){throw new Error('A "url" property or function must be specified')},q=function(t,e){var i=e.error;e.error=function(r){i&&i.call(e.context,t,r,e),t.trigger("error",t,r,e)}};return e});